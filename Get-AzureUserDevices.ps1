#install-module AzureAD
Get-AzureADUser -All $true | ForEach-Object { $user = $_; Write-Host "Processing user: $($user.UserPrincipalName)" -ForegroundColor Yellow; $devices = Get-AzureADUserRegisteredDevice -ObjectId $user.ObjectId -All $true; if ($devices) { $devices | ForEach-Object { Write-Host "  Found device: $($_.DisplayName)" -ForegroundColor Green; [PSCustomObject]@{ UserPrincipalName = $user.UserPrincipalName; DeviceName = $_.DisplayName } } } else { Write-Host "  No devices found for user: $($user.UserPrincipalName)" -ForegroundColor Red; [PSCustomObject]@{ UserPrincipalName = $user.UserPrincipalName; DeviceName = "No devices found" } } } | Export-Csv -Path "Users_And_Devices.csv" -NoTypeInformation -Encoding UTF8; Write-Host "Processing completed. Results saved to Users_And_Devices.csv." -ForegroundColor Cyan
